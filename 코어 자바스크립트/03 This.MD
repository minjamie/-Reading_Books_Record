# 03 This

자바스크립트에서 this는 어디서든 사용할 수 있으며 상황에 따라 this가 바라보는 대상이 달라진다.
함수와 객체(메서드)의 구분이 느슨한 자바스크립트에선 this가 실질적으로 이 둘을 구분하는 유일한 기능이다

## 01 상황에 따라 달라지는 this

1. this는 언제 생길까?
   **this는 호출한 주체에 대한 정보가 담기며** 자바스크립트에서 this는 실행 컨텍스트가 생성될 때 함께 결정된다.
   실행 컨텍스트는 함수를 호출할 때 생성되므로, \*\*바꿔 말하면 this는 함수를 호출할 때 결정된다. 즉 , 함수를 어떤 방식으로 호출하느냐에 따라 값이 달라진다.

다양한 상황과 각 상황별 this가 어떤 값을 보게 될까?** 2. 전역 공간에서의 this
**전역 공간에서 this는 전역 객체를 가리킨다.\*\* 전역 컨텍스트를 생성하는 주체가 바로 전역 객체이기 때문이다.
전역 객체는 자바스크립트 런타임 환경에 따라 다른 이름과 정보를 가지는데 브라우저 환경에선 window, Node.js에선 global이다.

3. 전역 공간에서만 발생하는 특이한 성질
   \*\*전역 변수를 선언하면 자바스크립트 엔진은 이를 전역객체의 프로퍼티로 할당한다.

전역 객체의 프로퍼티로 할당한 경우 삭제가 되는 반면 전역변수로 선언한 경우엔 삭제가 되지 않는다.**
var로 선언한 전역변수와 전역객체의 프로퍼티는 **호이스팅 여부 및 configurable여부에서 차이\*\*를 보인다

4.  메서드로서 호출할 때 그 메서드 내부에서의 this
    어떤 함수를 메서드로 호출하는 경우 호출 주체는 바로 **함수명(프로퍼티명) 앞의 객체**이다. (.)앞에 명시된 객체가 곧 this.

함수와 메서드
함수를 실행하는 일반적인 두 가지 방식은 함수로서 호출하는 방법과 메서드로서 호출하는 경우이다.

함수와 메서드는 미리 정의한 동작을 수행하는 코드 뭉치로, 둘을 구분하는 유일한 차이는 **독립성**에 있다.

4_1. 함수
함수는 그 자체로 독립적인 기능을 수행
4_2. 메서드
메서드는 자신을 호출한 대상 객체에 관한 동작을 수행

어떤 함수를 객체의 프로퍼티로 할당하면 객체의 메서드로서 호출할 경우만 메서드로 동작하고 그렇지 않으면 함수로 동작한다.

obj의 method프로퍼티에 할당한 값과 func변수에 할당한 값은 모두 선언한 함수를 참조하는데 즉, 원래의 익명함수는 그대론데 이를 \*\*변수에 담아 호출한 경우와 obj 객체의 프로퍼티에 할당해서 호출한 경우 this가 달라진다.

4_3. 함수와 메서드 구분?
함수 앞에 (.)이 있는지 여부로 구분, 함수 앞에 객체가 명시돼 있는 경우 메서드로 호출한 것며 그렇지 않은 경우엔 함수로 호출

4_3_1. 함수로서 호출 할 때 그 함수 내부에서의 this\*\*
함수를 함수로서 호출할 경우 this(호출한 주체에 대한 정보)가 지정되지 않는데, 함수로서 호출한 것은 호출 주체를 명시하지 않고 개발자가 코드 직접 관여해서 실행한 것이기 때문에 호출 주체의 정보를 알 수 없는 것이다.

실행 컨텍스트를 활성화할 당시 this가 지정되지 않은 경우 this는 전역 객체를 바라본다. 따라서 함수에서의 this역시 전역객체를 가리키는데 이는 명백한 설계상의 오류다

**4_3_2. 메서드 내부 함수에서의 this**
내부 함수 역시 이를 함수로서 호출했는지 메서드로 호출했는지만 파악하면 this값을 정확히 알 수 있다.

**this 바인딩** 관해서는 함수를 실행하는 **당시의 주변 환경(메서드 내부인지 함수내부인지)는 중요하지 않고 오직 해당 함수를 호출하는 구문 앞에 점 또는 대괄호표기가 있는지 없는지가 관건이다.** 5. 메서드의 내부 함수에서의 this를 우회하는 방법
변수를 활용하여 this를 상속할 수 있는데, 상위 스코프의 this를 저장해서 내부 함수에서 활용가능하다.

예시 - outer 스코프에서 self라는 변수에 this를 저장한 상태에서 호출한 innerFunc2의 경우 self에는 객체 obj가 출력된다.

6. this를 바인딩 하지 않는 함수
   6_1. ES6에 화살표 함수
   함수 내부에서 this가 전역객체를 바라보는 문제 보완하고자 등장한 this를 바인딩하지 않는 함수
   화살표 함수는 실행컨텍스트를 생성할 때 this바인딩 과정 자체가 빠지며 상위 스코프의 this를 그대로 활용한다.

6_2. call과 apply
그 밖에도 **call, apply등의 메서드를 활용해 함수를 호출할 때 명시적으로 this를 저장**하는 방법이 있다. 7. 콜백 함수 호출 시 그 함수 내부에서의 this
7_1. 콜백함수란 ?
**함수 A의 제어권을 다른 함수 B에게 넘겨주는 경우 함수 A를 콜백함수라 부른다.
이때 함수 A는 함수 B의 내부 로직에 따라 실행되며 this 역시 함수 B 내부로직에 정한 규칙에 따라 값이 결정된다**

콜백함수도 함수이기에 기본적으로 this가 전역객체이지만 제어권을 받은 함수에서 콜백함수에 별도로 this를 지정한 경우엔 그 대상을 참조한다.

**콜백함수의 제어권을 가지는 함수(메서드)가 콜백함수에서의 this를 무엇으로 할지를 결정하며 특별히 정의하지 않은 경우엔 기본적으로 함수와 마찬가지로 전역객체를 바라본다.** 8. 생성자 함수 내부에서의 this
8_1. 생성자 함수
**생성자 함수는 어떤 공통된 성질을 지니는 객체들을 생성하는데 사용하는 함수**로 객체 지향 언어에서는 생성자를 클래스, 클래스를 통해 만든 객체를 인스턴스 라고 한다.

프로그래밍적으로 **생성자는 구체적인 인스턴스를 만들기 위한 일종의 틀**
이 틀에는 클래스의 공통 속성들이 준비되어있고 구체적인 인스턴스의 개성을 더해 개별 인스턴스를 만들 수 있다.

자바스크립트에선 **함수에 생성자로서의 역할을 함께 부여해 new 명령어**와 함께 **함수를 호출하면 해당 함수가 생성자로서 동작**한다.
어떤 **함수가 생성자**

---

## 02 명시적으로 this를 바인딩하는 방법

상황별 this에 어떤 값이 바인딩되는지 살펴보았다면 이러한 규칙을 깨고 this에 별도의 대상을 바인딩하는 방법이 있다.

9. call 메서드
   **call 메서드는 메서드의 호출 주체인 함수를 즉시 실행**하도록 하는 명령이다. 이때 **call 메서드의 첫 번째 인자를 this로 바인딩**하고 이후 **인자들을 호출할 함수의 매개변수**로한다.

함수를 그냥 실행하면 this는 전역객체를 참조하지만 **call 메서드를 이용하면 임의의 객체를 this로 지정**할 수 있다.
메서드도 객체의 메서드를 호출하면 this는 객체를 참조하지만 **call 메서드를 이용하면 임의의 객체를 this로 지정**할 수 있다.

10. apply 메서드
    **apply 메서드는 call 메서드와 기능적으로 완전 동일한데,** call 메서드는 첫 번째 인자를 제외한 나머지 모든 인자들을 호출할 함수의 매개변수로 지정하는 반면 **apply 메서드는 두 번째 인자를 배열로 받아 그 배열의 요소들을 호출할 함수의 매개변수로 지정**한다는 점에서만 차이가 있다.

11. call/apply 메서드 활용
    두 메서드를 활용하면 자바스크립트를 다채롭게 활용할 수 있는데 그 사례는 다음과 같다.

**유사배열객체에 배열 메서드를 적용**

    11_1 . 유사 배열객체에 배열 메서드 사용
    객체에는 배열 메서드를 직접 적용할 수 없지만 **키가 0또는 양의 정수인 프로퍼티가 존재하고 length 프로퍼티의 값이 0또는 양의 정수인,** 배열의 구조와 유사한 객체의 경우 call / apply 메서드를 이용해 배열 메서드를 차용할 수 있다.

    11_2. arguments, NodeList에 유사 배열 메서드 적용
    함수 내부에서 접근할 수 있는 arguments 객체도 유사배열 객체이므로 배열로 전환해서 활용가능하며 querySelectorAll, getElemntsByClassName 등의 Node 선택자로 선택한 결과인 NodeList도 마찬가지다.

    11_3. 그 외에(문자열에 배열 메서드 적용)
    - 유사 배열 객체에는 call/apply 메서드 활용해 모든 배열 메서드 활용 가능
    - 문자열도 마찬가지다 단, 문자열은 length 프로퍼티가 읽기 전용으로 원본 문자열에 변경가하는 메서드는 에러를 던지고 concat처럼 대상이 반드시 배열이어야하는 경우에는 에러가 나지 않지만 제대로된 결과를 얻긴 힘들다

    11_4. ES6 Array.from 메서드

    유사배열객체 또는 순회가능한 모든 종류의 데이터 타입을 배열로 전환하는 Array.from메서드를 도입하여 배열 형태로 형변환이 가능하다

    11_5. 생성자 내부에서 다른 생성자를 호출

    생성자 내부에서 다른 생성자와 공통된 내용이 있을 경우 call 또는apply 메서드를 이용해 다른 생성자를 호출하면 반복을 줄일 수 있다.

    11_6. 여러 인수를 묶어서 하나의 배열로 전달하고 싶을 때 - apply 활용

    여러 개의 인수를 받는 메서드에게 하나의 배열로 인수를 전달하고 싶을 때 apply 메서드를 사용하면 좋다.
    예 - 배열 최대 최솟값 구할 경우, apply 사용하지 않으면 직접 구현해야한다.
    Math.max/min메서드에 apply를 적용하면 훨씬 간단한데 spread, 펼치기 연산자를 이용하면 더 간단하게 사용할 수 있다

12. bind 메서드
    bind 메서드는 ES5에 추가된 기능으로 **call과 비슷하지만 즉시 호출하지 않고 넘겨받은 this 및 인수들을 바탕으로 새로운 함수를 반환하기만 하는 메서드**이다.
    새로운 함수를 호출할 때 인수를 넘기면 그 인수들은 기존 bind메서드를 호출할 때 전달했던 인수들의 뒤에 이어서 등록된다.

bind 메서드는 1> 함수에 this를 미리 적용하는 것과2> 부분 적용 함수를 구현하는 두 가지 목적을 지닌다.

name 프로퍼티
bind메서드를 적용해서 새로 만든 함수는 name 프로퍼티에 동사 bind의 수동태 bound라는 접두어가 붙는다.
예 - 어떤 함수의 name 프로퍼티가 boundxxx라면 함수명이 xxx인 원본 함수에 bind메서드를 적용한 새로운 함수라는 의미로 call / apply보다 코드를 추적하기 수월해진다.

13. 상위 컨텍스트의 this를 내부 함수나 콜백 함수에 전달하기
    apply call bind 사용방식 비교
    콜백 함수 내 this에 관여하는 함수 또는 메서드에 대해서도 bind 메서드 사용하면 this 값을 사용자 입맛에 맞게 바꿀 수 있다

14. 화살표함수의 예외사항
    **화살표 함수 내부에는 this가 없고 접근하고자하면 스코프체인상 가장 가까운 this에 접근한다.**

15. 별도의 인자로 this를 받는 경우(콜백 함수 내서의 this)
    콜백 함수를 인자로 받는 메서드 중 일부는 추가로 this로 지정할 객체를 인자로 지정할 수 있는데
    **내부 요소에 대한 같은 동작을 반복 수행하는 배열 메서드에 많이 포진되어있다**
