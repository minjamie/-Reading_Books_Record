
#### 1.2 예시 프로그램 본 소감
- 설계가 나쁜 시스템은 수정하기 어려움
- 원하는 동작을 수행하기 위해 수정해야할 부분 찾고 기존 코드와 잘 맞물려 작동하게 할 방법 강구하기 어렵기 때문
- 무엇을 수정할지 찾기 어렵다면 실수 저질러 버그 생길 가능성도 높아짐

#### 코드 수정 전 고려 사항
> 프로그램 작동 방식 더 쉽게 파악할 수 있도록 코드를 여러 함수와 프로그램 요소로 재구성
=> 프로그램이 새로운 기능 추가하기 편한 구조 아니라면, 먼저 기능 추가하기 쉬운 형태로 리팩터링하고 나서 원하는 기능을 추가

1. 청구 내역을 HTML로 출력하는 기능 필요 - 해당 변경이 어느 부분에 영향 줄지 생각
> 청구 결과에 문자열 추가하는 문장 각각 조건문으로 감싸기
-> statement() 함수 복잡도 크게 증가
> 연극 장르와 공연료 정책 달라질 때마다 statement() 함수 수정해야함


#### 1.3 리팩토링 첫 단계
1. 리팩토링 첫 단계, 코드 영역 꼼꼼하게 검사해줄 테스트 코드부터 마련
- statement() 함수 테스트 구성하기
  - 함수가 문자열 반환하므로 다양한 장르 공연들로 구성된 공연료 청구서 몇 개 미리 작성해 문자열 형태로 준비
  - statement() 함수 반환한 문자열과 준비해둔 정답 문자열 비교
  - 테스트 프레임워크 이용해 모든 테스트 단축키 하나로 실행할 수 있도록 설정
  *) 여기서 중요한 부분은 테스트 결과를 보고하는 방식 - 성공/실패 스스로 판단하는 자가진단 테스트 만들기

#### 리팩토링 하기 전 제대롣 된 테스트부터 마련, 테스트는 반드시 자가진단하도록 만듦

#### 1.4 statement() 함수 쪼개기
- statement() 처럼 긴 함수 리팩터링 시 먼저 전체 동작 각각 부분으로 나눌 수 있는 지점 찾기
  - switch문은 한 번 공연에 대한 요금 계산 > 코드 조각 별도 함수로 추출하는 방식으로 파악한 정보를 코드에 반영
  - 추출한 함수엔 코드가 하는 일 설명하는 이름 지어준다
  - 코드 조각 함수 추출 시 최소화해주는 절차 마련, 해당 절차 기록해두고 참조하기 쉽도록 함수 추출하기 이름 붙임
  - 별도 함수 뺐을 시 유효범위 벗어나는 변수, 새 함수에서 곧바로 사용할 수 없는 변수 있는지 확인
  - perf와 play는 추출한 새 함수에서도 필요하지만 값 변경되지 않아 매개변수로 전달, 한 편 thisAmount는 함수 안에서 값이 바뀌는 이런 변수 조심해서 다뤄야함
    - 이런 변수가 하나 뿐이므로 값을 반환하도록 작성, 변수를 초기화하는 코드도 추출한 함수에 넣기
    - 추출한 함수로 수정하고 나면 곧바로 컴파일 하고 테스트 해서 실수한게 없는지 확인
    - 한 가지 수정할 때마다 테스트하면 오류가 생기더라도 변경 폭이 작아 살펴볼 범위도 좁아 문제 찾고 해겨하기 쉬움
    *) 조금씩 변경하고 매번 테스트 하는 것이 리팩터링 절차 핵심, 한 번에 너무 많이 수정하려다 실수 저지르면 디버깅 하기어려워 결과적으로 작업 시간이 늘어남
    *) 조금씩 수정해 피드백 주기 짧게 가져가는 습관이 이러한 재앙 피하는 길
    - amountFor()를 statement() 중첩함수로 만들 수 있는데 이렇게 하면 바깥 함수에서 쓰던 변수를 새로 추출한 함수에 매개변수로 전달할 필요가 없어 편함
- 함수 추출 후 추출된 함수 코드 들여다보고 명확하게 표현할 수 있는 방법 검토, 변수 이름 더 명확히 바꾸기
- 첫 번째 인수 perf를 aPerformance로 리팩토링
  - 자바스크립트 같이 동적 언어 사용 시 타입 드러가네 작성하면 도움되는데 매개변수 이름에 접두어로 타입으름 적기 > 매개변수 역할 뚜렷하지 않을 땐 a/an 부정관사 붙이기
  - 좋은 코드라면 하는 일이 명확히 드러나야 하며 변수 이름은 커다란 역할을 함 > 명확성 높이기 위한 이름 바꾸기에도 망설이지 말자
- play 매개벼변수 이름 바꾸기
  - 긴 함수 쪼갤 시 play같은 변수 최대한 제거 >  임시 변수 들 땜에 로컬  범위 존재하는 이름 늘어나 추출작업 복잡
  *) 임시 변수 질의함수로 바꾸기
  - 대입문 우변을 함수로 추출
  - 컴파일 테스트 커밋 후 다음 변수 인라인하기 적용
  - 변수 인라인한 덕에 amountFor()에 함수 선언 바꾸기 적용하여 play 매개변수 제거
- 새로 만든 playFor() 사용하도록 amountFor 수정
> 이전 코드 루프 한 번 돌 때 마다 공연 조회 VS 리팩토링 코드 세번이나 조회
성능의 관게 설명하지만 지역 변수 제거함으로서 얻은 큰 장점 >유효범위 신경써야할 대상 줄어들어 > 추출 작업 쉬워짐 
- 값이 바뀌지 않는다면 변수 인라인 적용하기

#### 적립 포인트 계산 코드 추출
- play 변수 제거한 결과 로컬 유효범위 변수 하나 줄어 적립 포인트 계산 부분 추출하기 쉬워짐
-volumeCredits는 반복문 돌 때마다 값 누적해야해 까다로운데 최선 방법은 추출한 함수에서 volumeCredits의 복제본 초기화 한 뒤 계산 결과 반환

#### format 변수 제거
- 임시 변수 나중에 문제 일으킬 수 있으니 자신이 속한 루틴에만 의미가 있기에 루틴이 길고 복잡해지기 쉬움
- 이러한 임시 변수 제거 > format은 임시 변수에 함수를 대입한 형태
함수 직접 선언해 바꾸기
- 이름 짓기 중요하면서도 쉽지 않은 작업 > 이름 좋으면 본문 읽지 않고도 무슨 일 하는지 알 수 있음

#### volumeCredits 변수 제거
- 반목문 쪼개기로 volumeCredits 값 누적되는 부분 따로 빼기
- 문장 슬라이드하기 적용해 volumeCredits 변수 선언하는 문장 반복문 바로 아프로 옮김
- volumeCredits 값 갱신과 관련된 문장 한데 모아두면 임시 변수 질의 함수로 바꾸기 수월
- volumeCredits 값 계산 코드 함수로 추출하기
- 잘다뤄진 코드라야 성능 개선 작업도 훨씬 수월

1. 반목문 쪼개기로 변수 값 누적 시키는 부분 분리
2. 문장 슬라이드로 변수 초기화 문장을 변수 값 누적 코드 바로 앞으로 옮김
3. 함수 추출하기로 적립 포인트 계싼 부분 별도 함수로 추출
4. 변수 인라인하기로 volumeCredit 변수 제거
#### 리팩토링 프로그램 수정은 작은 단계로 나눠 진행, 중간에 실수하더라고 버그 쉽게 찾을 수 있음
