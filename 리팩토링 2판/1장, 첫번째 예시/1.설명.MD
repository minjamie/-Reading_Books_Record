
#### 1.2 예시 프로그램 본 소감
- 설계가 나쁜 시스템은 수정하기 어려움
- 원하는 동작을 수행하기 위해 수정해야할 부분 찾고 기존 코드와 잘 맞물려 작동하게 할 방법 강구하기 어렵기 때문
- 무엇을 수정할지 찾기 어렵다면 실수 저질러 버그 생길 가능성도 높아짐

#### 코드 수정 전 고려 사항
> 프로그램 작동 방식 더 쉽게 파악할 수 있도록 코드를 여러 함수와 프로그램 요소로 재구성
=> 프로그램이 새로운 기능 추가하기 편한 구조 아니라면, 먼저 기능 추가하기 쉬운 형태로 리팩터링하고 나서 원하는 기능을 추가

1. 청구 내역을 HTML로 출력하는 기능 필요 - 해당 변경이 어느 부분에 영향 줄지 생각
> 청구 결과에 문자열 추가하는 문장 각각 조건문으로 감싸기
-> statement() 함수 복잡도 크게 증가
> 연극 장르와 공연료 정책 달라질 때마다 statement() 함수 수정해야함


#### 1.3 리팩토링 첫 단계
1. 리팩토링 첫 단계, 코드 영역 꼼꼼하게 검사해줄 테스트 코드부터 마련
- statement() 함수 테스트 구성하기
  - 함수가 문자열 반환하므로 다양한 장르 공연들로 구성된 공연료 청구서 몇 개 미리 작성해 문자열 형태로 준비
  - statement() 함수 반환한 문자열과 준비해둔 정답 문자열 비교
  - 테스트 프레임워크 이용해 모든 테스트 단축키 하나로 실행할 수 있도록 설정
  *) 여기서 중요한 부분은 테스트 결과를 보고하는 방식 - 성공/실패 스스로 판단하는 자가진단 테스트 만들기

#### 리팩토링 하기 전 제대롣 된 테스트부터 마련, 테스트는 반드시 자가진단하도록 만듦

#### 1.4 statement() 함수 쪼개기
- statement() 처럼 긴 함수 리팩터링 시 먼저 전체 동작 각각 부분으로 나눌 수 있는 지점 찾기
  - switch문은 한 번 공연에 대한 요금 계산 > 코드 조각 별도 함수로 추출하는 방식으로 파악한 정보를 코드에 반영
  - 추출한 함수엔 코드가 하는 일 설명하는 이름 지어준다
  - 코드 조각 함수 추출 시 최소화해주는 절차 마련, 해당 절차 기록해두고 참조하기 쉽도록 함수 추출하기 이름 붙임
  - 별도 함수 뺐을 시 유효범위 벗어나는 변수, 새 함수에서 곧바로 사용할 수 없는 변수 있는지 확인
  - perf와 play는 추출한 새 함수에서도 필요하지만 값 변경되지 않아 매개변수로 전달, 한 편 thisAmount는 함수 안에서 값이 바뀌는 이런 변수 조심해서 다뤄야함
    - 이런 변수가 하나 뿐이므로 값을 반환하도록 작성, 변수를 초기화하는 코드도 추출한 함수에 넣기
    - 추출한 함수로 수정하고 나면 곧바로 컴파일 하고 테스트 해서 실수한게 없는지 확인
    - 한 가지 수정할 때마다 테스트하면 오류가 생기더라도 변경 폭이 작아 살펴볼 범위도 좁아 문제 찾고 해겨하기 쉬움
    *) 조금씩 변경하고 매번 테스트 하는 것이 리팩터링 절차 핵심, 한 번에 너무 많이 수정하려다 실수 저지르면 디버깅 하기어려워 결과적으로 작업 시간이 늘어남
    *) 조금씩 수정해 피드백 주기 짧게 가져가는 습관이 이러한 재앙 피하는 길
    - amountFor()를 statement() 중첩함수로 만들 수 있는데 이렇게 하면 바깥 함수에서 쓰던 변수를 새로 추출한 함수에 매개변수로 전달할 필요가 없어 편함
- 함수 추출 후 추출된 함수 코드 들여다보고 명확하게 표현할 수 있는 방법 검토, 변수 이름 더 명확히 바꾸기
- 첫 번째 인수 perf를 aPerformance로 리팩토링
  - 자바스크립트 같이 동적 언어 사용 시 타입 드러가네 작성하면 도움되는데 매개변수 이름에 접두어로 타입으름 적기 > 매개변수 역할 뚜렷하지 않을 땐 a/an 부정관사 붙이기
  - 좋은 코드라면 하는 일이 명확히 드러나야 하며 변수 이름은 커다란 역할을 함 > 명확성 높이기 위한 이름 바꾸기에도 망설이지 말자
- play 매개벼변수 이름 바꾸기
  - 긴 함수 쪼갤 시 play같은 변수 최대한 제거 >  임시 변수 들 땜에 로컬  범위 존재하는 이름 늘어나 추출작업 복잡
  *) 임시 변수 질의함수로 바꾸기
  - 대입문 우변을 함수로 추출
  - 컴파일 테스트 커밋 후 다음 변수 인라인하기 적용
  - 변수 인라인한 덕에 amountFor()에 함수 선언 바꾸기 적용하여 play 매개변수 제거 
#### 리팩토링 프로그램 수정은 작은 단계로 나눠 진행, 중간에 실수하더라고 버그 쉽게 찾을 수 있음
